@model Bevera.Models.ViewModels.HomeIndexVm

@{
    ViewData["Title"] = "Home";
    ViewData["BodyClass"] = "home";
}

<!-- ================= HERO / SLIDER ================= -->
<div id="beveraCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-indicators">
        <button type="button" data-bs-target="#beveraCarousel" data-bs-slide-to="0" class="active" aria-current="true"></button>
        <button type="button" data-bs-target="#beveraCarousel" data-bs-slide-to="1"></button>
        <button type="button" data-bs-target="#beveraCarousel" data-bs-slide-to="2"></button>
    </div>

    <div class="carousel-inner">
        <div class="carousel-item active">
            <img src="~/images/image-1.jpg" class="d-block w-100 hero-img" alt="Bevera slide 1">
            <div class="carousel-caption text-start hero-caption">
                <h1 class="hero-title">Bevera</h1>
                <h3 class="hero-subtitle">Склад за напитки</h3>
                <p class="hero-text">
                    Bevera – вашият склад за безалкохолни и алкохолни напитки.
                    Бързи поръчки, контрол на наличности и сигурна доставка.
                </p>
                <a class="btn hero-btn" href="#footer">About & Contact</a>
            </div>
        </div>

        <div class="carousel-item">
            <img src="~/images/image-2.jpg" class="d-block w-100 hero-img" alt="Bevera slide 2">
            <div class="carousel-caption text-start hero-caption">
                <h2 class="hero-subtitle">Промо оферти</h2>
                <p class="hero-text">Специални цени за бизнес клиенти и обекти.</p>
                <a class="btn hero-btn" href="#footer">Контакт</a>
            </div>
        </div>

        <div class="carousel-item">
            <img src="~/images/image-3.jpg" class="d-block w-100 hero-img" alt="Bevera slide 3">
            <div class="carousel-caption text-start hero-caption">
                <h2 class="hero-subtitle">Нови наличности</h2>
                <p class="hero-text">Води, сокове, енергийни напитки, бира и алкохол.</p>
                <a class="btn hero-btn" href="#footer">Виж още</a>
            </div>
        </div>
    </div>

    <button class="carousel-control-prev" type="button" data-bs-target="#beveraCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#beveraCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>

<!-- ================= BEST SELLERS (HIT) ================= -->
<section class="container my-5">
    <div class="d-flex align-items-end justify-content-between mb-3">
        <div>
            <h2 class="section-title mb-0">Най-продавани</h2>
            <div class="text-muted">Хитовете, които се поръчват най-много.</div>
        </div>
    </div>

    @if (Model?.BestSellers == null || Model.BestSellers.Count == 0)
    {
        <div class="alert alert-light border">Още няма достатъчно поръчки, за да изчислим хитовете.</div>
    }
    else
    {
        <div class="cards-rail" data-rail="hits">
            <button class="rail-arrow left" type="button" aria-label="Назад" onclick="railScroll('hits', -1)"><i class="bi bi-chevron-left"></i></button>
            <div class="rail" id="rail-hits">
                @foreach (var p in Model.BestSellers)
                {
                    <div class="rail-item">
                        <a class="product-card" asp-controller="Client" asp-action="Product" asp-route-id="@p.Id">
                            <div class="product-img position-relative">
                                <span class="hit-badge">ХИТ</span>
                                @if (!string.IsNullOrWhiteSpace(p.ImagePath))
                                {
                                    <img src="@p.ImagePath" alt="@p.Name" />
                                }
                            </div>
                            <div class="product-body">
                                <div class="product-name">@p.Name</div>
                                            <div class="product-price">@p.Price.ToString("0.00") €</div>
                            </div>
                        </a>
                    </div>
                }
            </div>
            <button class="rail-arrow right" type="button" aria-label="Напред" onclick="railScroll('hits', 1)"><i class="bi bi-chevron-right"></i></button>
        </div>
        <div class="rail-dots" id="dots-hits"></div>
    }
</section>

<!-- ================= NEWEST ================= -->
<section class="container my-5">
    <div class="d-flex align-items-end justify-content-between mb-3">
        <div>
            <h2 class="section-title mb-0">Най-нови</h2>
            <div class="text-muted">Последно добавени продукти в склада.</div>
        </div>
    </div>

    @if (Model?.Newest == null || Model.Newest.Count == 0)
    {
        <div class="alert alert-light border">Няма продукти.</div>
    }
    else
    {
        <div class="cards-rail" data-rail="new">
            <button class="rail-arrow left" type="button" aria-label="Назад" onclick="railScroll('new', -1)"><i class="bi bi-chevron-left"></i></button>
            <div class="rail" id="rail-new">
                @foreach (var p in Model.Newest)
                {
                    <div class="rail-item">
                        <a class="product-card" asp-controller="Client" asp-action="Product" asp-route-id="@p.Id">
                            <div class="product-img">
                                @if (!string.IsNullOrWhiteSpace(p.ImagePath))
                                {
                                    <img src="@p.ImagePath" alt="@p.Name" />
                                }
                            </div>
                            <div class="product-body">
                                <div class="product-name">@p.Name</div>
                                            <div class="product-price">@p.Price.ToString("0.00") €</div>
                            </div>
                        </a>
                    </div>
                }
            </div>
            <button class="rail-arrow right" type="button" aria-label="Напред" onclick="railScroll('new', 1)"><i class="bi bi-chevron-right"></i></button>
        </div>
        <div class="rail-dots" id="dots-new"></div>
    }
</section>

<!-- ================= FOOTER LIKE SCREENSHOT ================= -->
<section id="footer" class="bevera-footer">
    <div class="container py-5">
        <div class="row gy-4">

            <!-- Left brand -->
            <div class="col-lg-4">
                <div class="footer-brand">BEVERA</div>
                <div class="footer-muted mt-3">
                    Склад за напитки – система за поръчки и наличности.
                </div>
            </div>

            <!-- About -->
            <div class="col-lg-4">
                <div class="footer-heading">About</div>
                <ul class="footer-links">
                    <li>Bevera е платформа за управление на склад и поръчки.</li>
                    <li>Клиент → заявка → работник → одобрение → доставка.</li>
                </ul>
            </div>

            <!-- Contact -->
            <div class="col-lg-4">
                <div class="footer-heading">Contact</div>
                <ul class="footer-links">
                    <li>Email: <span class="footer-strong">teodorastt15@gmail.com</span></li>
                    <li>Телефон: <span class="footer-strong">0888863463</span></li>
                </ul>
            </div>

        </div>

        <div class="footer-bottom mt-4 pt-4">
            © 2026 Bevera. All rights reserved.
        </div>
    </div>
</section>

<style>
    /* hero: НЕ ги правим огромни */
    .hero-img {
        height: 60vh; /* по-нормално */
        max-height: 560px; /* да не расте безкрайно */
        min-height: 420px; /* да не стане прекалено ниско */
        object-fit: cover;
        filter: brightness(0.60);
    }

    .hero-caption {
        bottom: 18%;
        max-width: 820px;
    }

    .hero-title {
        font-family: 'Playfair Display', serif;
        font-weight: 700;
        font-size: 3.6rem;
        letter-spacing: .5px;
        margin-bottom: .35rem;
    }

    .hero-subtitle {
        font-weight: 600;
        margin-bottom: .9rem;
    }

    .hero-text {
        font-size: 1.05rem;
        color: rgba(255,255,255,.92);
        max-width: 680px;
    }

    .hero-btn {
        background: #FAE3C6;
        border: 0;
        color: #111;
        font-weight: 700;
        border-radius: 999px;
        padding: .75rem 1.4rem;
    }

        .hero-btn:hover {
            filter: brightness(.95);
        }

    /* placeholder */
    .placeholder-block {
        border: 1px dashed rgba(0,0,0,.25);
        background: #fff;
    }

    .section-title {
        font-family: 'Playfair Display', serif;
        font-weight: 700;
    }

    /* cards rail */
    .cards-rail {
        position: relative;
    }

    .rail {
        display: grid;
        grid-auto-flow: column;
        grid-auto-columns: minmax(220px, 1fr);
        gap: 18px;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        padding: 4px 44px 10px;
        scrollbar-width: none;
    }

        .rail::-webkit-scrollbar {
            display: none;
        }

    .rail-item {
        scroll-snap-align: start;
    }

    .rail-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 38px;
        height: 38px;
        border-radius: 12px;
        border: 1px solid rgba(0,0,0,.10);
        background: rgba(255,255,255,.95);
        box-shadow: 0 8px 18px rgba(0,0,0,.12);
        display: grid;
        place-items: center;
        z-index: 2;
    }

        .rail-arrow.left {
            left: 6px;
        }

        .rail-arrow.right {
            right: 6px;
        }

    .rail-dots {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 8px;
    }

    .rail-dot {
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: rgba(0,0,0,.25);
        cursor: pointer;
    }

        .rail-dot.active {
            background: rgba(77, 21, 25, .95);
            transform: scale(1.2);
        }

    .hit-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        padding: 6px 10px;
        font-size: .75rem;
        font-weight: 900;
        letter-spacing: .06em;
        border-radius: 10px;
        background: #f5b301;
        color: #111;
        box-shadow: 0 10px 22px rgba(0,0,0,.12);
    }

    /* footer like screenshot */
    .bevera-footer {
        background: #FAE3C6; /* светло зелено като примера */
        border-top: 1px solid rgba(0,0,0,.06);
    }

    .footer-brand {
        font-family: 'Playfair Display', serif;
        font-weight: 800;
        font-size: 2.4rem;
        letter-spacing: .06em;
        color: #0b0c0e;
    }

    .footer-heading {
        font-weight: 800;
        letter-spacing: .02em;
        text-transform: uppercase;
        font-size: .95rem;
        margin-bottom: 1rem;
        color: #0b0c0e;
    }

    .footer-muted {
        color: rgba(0,0,0,.65);
        line-height: 1.6;
    }

    .footer-links {
        list-style: none;
        padding-left: 0;
        margin: 0;
        color: rgba(0,0,0,.75);
        line-height: 2;
    }

    .footer-strong {
        color: rgba(0,0,0,.95);
        font-weight: 700;
    }

    .footer-bottom {
        border-top: 1px solid rgba(0,0,0,.10);
        color: rgba(0,0,0,.60);
        font-size: .92rem;
        text-align: center;
    }

    /* anchor offset */
    html {
        scroll-padding-top: 90px;
    }
</style>

@section Scripts {
    <script>
        function railScroll(key, dir) {
            const rail = document.getElementById('rail-' + key);
            if (!rail) return;
            const card = rail.querySelector('.rail-item');
            const step = card ? (card.getBoundingClientRect().width + 18) * 2 : 500;
            rail.scrollBy({ left: dir * step, behavior: 'smooth' });
        }

        function setupDots(key) {
            const rail = document.getElementById('rail-' + key);
            const dots = document.getElementById('dots-' + key);
            if (!rail || !dots) return;

            const items = rail.querySelectorAll('.rail-item');
            const pages = Math.max(1, Math.ceil(items.length / 4));
            dots.innerHTML = '';

            for (let i = 0; i < pages; i++) {
                const d = document.createElement('div');
                d.className = 'rail-dot' + (i === 0 ? ' active' : '');
                d.addEventListener('click', () => {
                    const card = rail.querySelector('.rail-item');
                    const step = card ? (card.getBoundingClientRect().width + 18) * 4 : 900;
                    rail.scrollTo({ left: i * step, behavior: 'smooth' });
                });
                dots.appendChild(d);
            }

            rail.addEventListener('scroll', () => {
                const max = rail.scrollWidth - rail.clientWidth;
                const ratio = max <= 0 ? 0 : rail.scrollLeft / max;
                const idx = Math.min(pages - 1, Math.round(ratio * (pages - 1)));
                dots.querySelectorAll('.rail-dot').forEach((x, j) => x.classList.toggle('active', j === idx));
            });
        }

        setupDots('hits');
        setupDots('new');
        window.addEventListener('resize', () => { setupDots('hits'); setupDots('new'); });
    </script>
}
